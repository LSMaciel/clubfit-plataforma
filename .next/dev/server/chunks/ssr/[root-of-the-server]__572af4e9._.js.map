{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/app/admin/academies/actions.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { redirect } from 'next/navigation'\nimport { revalidatePath } from 'next/cache'\n\nexport async function createAcademy(prevState: any, formData: FormData) {\n  const supabase = await createClient()\n\n  // 1. Verificação de Segurança (Apenas Super Admin)\n  const { data: userData } = await supabase.from('users').select('role').single()\n  if (userData?.role !== 'SUPER_ADMIN') {\n    return { error: 'Permissão negada.' }\n  }\n\n  const name = formData.get('name') as string\n  const slug = formData.get('slug') as string\n  const primaryColor = formData.get('primary_color') as string\n  const logoFile = formData.get('logo') as File\n\n  // Novos Campos de Endereço V2\n  const zipCode = formData.get('zip_code') as string\n  const street = formData.get('street') as string\n  const number = formData.get('number') as string\n  const neighborhood = formData.get('neighborhood') as string\n  const city = formData.get('city') as string\n  const state = formData.get('state') as string\n  const complement = formData.get('complement') as string\n\n  // Tratamento de Lat/Long\n  const latStr = formData.get('latitude') as string\n  const lngStr = formData.get('longitude') as string\n  const latitude = latStr ? parseFloat(latStr) : null\n  const longitude = lngStr ? parseFloat(lngStr) : null\n\n  // 2. Validações Básicas\n  if (!name || !slug) {\n    return { error: 'Nome e Slug são obrigatórios.' }\n  }\n\n  // Validar formato do slug (apenas letras minúsculas e hifens)\n  const slugRegex = /^[a-z0-9-]+$/\n  if (!slugRegex.test(slug)) {\n    return { error: 'O Slug deve conter apenas letras minúsculas, números e hífens (sem espaços).' }\n  }\n\n  let logoUrl = null\n\n  // 3. Upload do Logo (se houver)\n  if (logoFile && logoFile.size > 0) {\n    // Gerar nome único para o arquivo\n    const fileExt = logoFile.name.split('.').pop()\n    const fileName = `${slug}-${Date.now()}.${fileExt}`\n    const filePath = `public/${fileName}`\n\n    const { error: uploadError } = await supabase.storage\n      .from('academy-logos')\n      .upload(filePath, logoFile)\n\n    if (uploadError) {\n      console.error('Erro upload:', uploadError)\n      return { error: 'Erro ao fazer upload da logo.' }\n    }\n\n    // Obter URL pública\n    const { data: { publicUrl } } = supabase.storage\n      .from('academy-logos')\n      .getPublicUrl(filePath)\n\n    logoUrl = publicUrl\n  }\n\n  // 4. Inserir no Banco de Dados\n  const { error: insertError } = await supabase\n    .from('academies')\n    .insert({\n      name,\n      slug,\n      primary_color: primaryColor || '#000000',\n      logo_url: logoUrl,\n      // Novos campos\n      zip_code: zipCode || null,\n      street: street || null,\n      number: number || null,\n      neighborhood: neighborhood || null,\n      city: city || null,\n      state: state || null,\n      complement: complement || null,\n      latitude: latitude,\n      longitude: longitude\n    })\n\n  if (insertError) {\n    if (insertError.code === '23505') { // Unique violation\n      return { error: 'Este Slug já está em uso. Escolha outro.' }\n    }\n    console.error('Erro insert:', insertError)\n    return { error: 'Erro ao cadastrar academia.' }\n  }\n\n  // 5. Finalizar\n  revalidatePath('/admin/academies')\n  redirect('/admin/academies')\n}\n"],"names":[],"mappings":";;;;;;;IAMsB,gBAAA,WAAA,GAAA,IAAA,+QAAA,EAAA,8CAAA,oQAAA,EAAA,KAAA,GAAA,0QAAA,EAAA"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/components/ui/form-input.tsx"],"sourcesContent":["import React, { forwardRef } from 'react'\n\ninterface FormInputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string\n  name: string\n  error?: string\n}\n\nexport const FormInput = forwardRef<HTMLInputElement, FormInputProps>(\n  ({ label, name, error, className = '', ...props }, ref) => {\n    return (\n      <div className=\"w-full\">\n        <label htmlFor={name} className=\"block text-sm font-medium text-slate-700 mb-1\">\n          {label}\n        </label>\n        <input\n          id={name}\n          name={name}\n          ref={ref}\n          className={`\n            block w-full rounded-md border-slate-300 shadow-sm \n            focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\n            border p-2\n            ${error ? 'border-red-500 focus:border-red-500 focus:ring-red-500' : ''}\n            ${className}\n          `}\n          {...props}\n        />\n        {error && <p className=\"mt-1 text-sm text-red-600\">{error}</p>}\n      </div>\n    )\n  }\n)\n\nFormInput.displayName = 'FormInput'"],"names":[],"mappings":";;;;;AAAA;;;AAQO,MAAM,0BAAY,IAAA,mPAAU,EACjC,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,YAAY,EAAE,EAAE,GAAG,OAAO,EAAE;IACjD,qBACE,8QAAC;QAAI,WAAU;;0BACb,8QAAC;gBAAM,SAAS;gBAAM,WAAU;0BAC7B;;;;;;0BAEH,8QAAC;gBACC,IAAI;gBACJ,MAAM;gBACN,KAAK;gBACL,WAAW,CAAC;;;;YAIV,EAAE,QAAQ,2DAA2D,GAAG;YACxE,EAAE,UAAU;UACd,CAAC;gBACA,GAAG,KAAK;;;;;;YAEV,uBAAS,8QAAC;gBAAE,WAAU;0BAA6B;;;;;;;;;;;;AAG1D;AAGF,UAAU,WAAW,GAAG"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/app/admin/academies/new/page.tsx"],"sourcesContent":["'use client'\n\nimport { useActionState } from 'react' // Note: In Next.js 14+ / React 18 canary this might be useFormState from react-dom\n// But for broader compatibility or newer React, we use the hooks available. \n// Assuming standard Next.js 14 server actions pattern.\n// If useActionState is not available, we use generic form handling.\n// Let's use standard client component form with server action prop.\n\nimport { createAcademy } from '../actions'\nimport { FormInput } from '@/components/ui/form-input'\nimport Link from 'next/link'\nimport { useState } from 'react'\n\nexport default function NewAcademyPage() {\n  const [error, setError] = useState<string | null>(null)\n  \n  // Wrapper para capturar erro da Server Action sem usar useFormState (para simplicidade e compatibilidade)\n  async function handleSubmit(formData: FormData) {\n    setError(null)\n    const result = await createAcademy(null, formData)\n    if (result?.error) {\n      setError(result.error)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 flex flex-col\">\n       <nav className=\"bg-white border-b border-slate-200 px-8 py-4\">\n        <div className=\"max-w-3xl mx-auto flex items-center gap-4\">\n            <Link href=\"/admin/academies\" className=\"text-sm text-slate-500 hover:text-slate-900\">\n                ← Voltar\n            </Link>\n            <h1 className=\"font-bold text-xl text-slate-900\">Nova Academia</h1>\n        </div>\n      </nav>\n\n      <main className=\"flex-1 p-8\">\n        <div className=\"max-w-3xl mx-auto\">\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-8\">\n                <form action={handleSubmit} className=\"space-y-6\">\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <FormInput \n                            label=\"Nome da Academia\" \n                            name=\"name\" \n                            placeholder=\"Ex: Ironberg CT\" \n                            required \n                        />\n                        <FormInput \n                            label=\"Slug (URL)\" \n                            name=\"slug\" \n                            placeholder=\"ex: ironberg-ct\" \n                            required \n                            pattern=\"^[a-z0-9-]+$\"\n                            title=\"Apenas letras minúsculas, números e hífens.\"\n                        />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <FormInput \n                            label=\"Cor Primária\" \n                            name=\"primary_color\" \n                            type=\"color\" \n                            defaultValue=\"#000000\"\n                            className=\"h-12 p-1 cursor-pointer\"\n                        />\n                         <div className=\"w-full\">\n                            <label htmlFor=\"logo\" className=\"block text-sm font-medium text-slate-700 mb-1\">\n                                Logo da Academia\n                            </label>\n                            <input\n                                id=\"logo\"\n                                name=\"logo\"\n                                type=\"file\"\n                                accept=\"image/*\"\n                                className=\"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200\"\n                            />\n                            <p className=\"mt-1 text-xs text-slate-400\">Recomendado: PNG ou JPG quadrado (500x500px)</p>\n                        </div>\n                    </div>\n\n                    {error && (\n                        <div className=\"bg-red-50 text-red-600 p-4 rounded-md text-sm border border-red-100\">\n                            {error}\n                        </div>\n                    )}\n\n                    <div className=\"pt-4 flex justify-end gap-3\">\n                        <Link \n                            href=\"/admin/academies\"\n                            className=\"px-4 py-2 border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50 text-sm font-medium\"\n                        >\n                            Cancelar\n                        </Link>\n                        <button\n                            type=\"submit\"\n                            className=\"px-4 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 text-sm font-medium\"\n                        >\n                            Criar Academia\n                        </button>\n                    </div>\n\n                </form>\n            </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAGA,6EAA6E;AAC7E,uDAAuD;AACvD,oEAAoE;AACpE,oEAAoE;AAEpE;AACA;AACA;AACA;AAXA;;;;;;AAae,SAAS;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iPAAQ,EAAgB;IAElD,0GAA0G;IAC1G,eAAe,aAAa,QAAkB;QAC5C,SAAS;QACT,MAAM,SAAS,MAAM,IAAA,kNAAa,EAAC,MAAM;QACzC,IAAI,QAAQ,OAAO;YACjB,SAAS,OAAO,KAAK;QACvB;IACF;IAEA,qBACE,8QAAC;QAAI,WAAU;;0BACZ,8QAAC;gBAAI,WAAU;0BACd,cAAA,8QAAC;oBAAI,WAAU;;sCACX,8QAAC,uMAAI;4BAAC,MAAK;4BAAmB,WAAU;sCAA8C;;;;;;sCAGtF,8QAAC;4BAAG,WAAU;sCAAmC;;;;;;;;;;;;;;;;;0BAIvD,8QAAC;gBAAK,WAAU;0BACd,cAAA,8QAAC;oBAAI,WAAU;8BACX,cAAA,8QAAC;wBAAI,WAAU;kCACX,cAAA,8QAAC;4BAAK,QAAQ;4BAAc,WAAU;;8CAElC,8QAAC;oCAAI,WAAU;;sDACX,8QAAC,+KAAS;4CACN,OAAM;4CACN,MAAK;4CACL,aAAY;4CACZ,QAAQ;;;;;;sDAEZ,8QAAC,+KAAS;4CACN,OAAM;4CACN,MAAK;4CACL,aAAY;4CACZ,QAAQ;4CACR,SAAQ;4CACR,OAAM;;;;;;;;;;;;8CAId,8QAAC;oCAAI,WAAU;;sDACX,8QAAC,+KAAS;4CACN,OAAM;4CACN,MAAK;4CACL,MAAK;4CACL,cAAa;4CACb,WAAU;;;;;;sDAEb,8QAAC;4CAAI,WAAU;;8DACZ,8QAAC;oDAAM,SAAQ;oDAAO,WAAU;8DAAgD;;;;;;8DAGhF,8QAAC;oDACG,IAAG;oDACH,MAAK;oDACL,MAAK;oDACL,QAAO;oDACP,WAAU;;;;;;8DAEd,8QAAC;oDAAE,WAAU;8DAA8B;;;;;;;;;;;;;;;;;;gCAIlD,uBACG,8QAAC;oCAAI,WAAU;8CACV;;;;;;8CAIT,8QAAC;oCAAI,WAAU;;sDACX,8QAAC,uMAAI;4CACD,MAAK;4CACL,WAAU;sDACb;;;;;;sDAGD,8QAAC;4CACG,MAAK;4CACL,WAAU;sDACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWzB"}}]
}