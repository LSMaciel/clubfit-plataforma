{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/utils/supabase/admin.ts"],"sourcesContent":["\nimport { createClient } from '@supabase/supabase-js'\n\n// Nota: Este cliente deve ser usado APENAS no servidor (Server Actions/API Routes)\n// Ele usa a Service Role Key para ignorar RLS e gerenciar Auth users.\nexport function createAdminClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\n\n  if (!serviceRoleKey) {\n    throw new Error('SUPABASE_SERVICE_ROLE_KEY não definida no .env.local')\n  }\n\n  return createClient(supabaseUrl, serviceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false\n    }\n  })\n}\n"],"names":[],"mappings":";;;;AACA;;AAIO,SAAS;IACd,MAAM;IACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;IAE5D,IAAI,CAAC,gBAAgB;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,uNAAY,EAAC,aAAa,gBAAgB;QAC/C,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/utils/auth-student.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from 'jose'\r\nimport { cookies } from 'next/headers'\r\n\r\nconst SECRET_KEY = process.env.SUPABASE_JWT_SECRET || 'fallback-secret-key-change-me'\r\nconst key = new TextEncoder().encode(SECRET_KEY)\r\n\r\nexport async function encryptStudentSession(payload: any) {\r\n    return await new SignJWT(payload)\r\n        .setProtectedHeader({ alg: 'HS256' })\r\n        .setIssuedAt()\r\n        .setExpirationTime('30d') // Longa duração para \"App\" feel\r\n        .sign(key)\r\n}\r\n\r\nexport async function decryptStudentSession(input: string): Promise<any> {\r\n    try {\r\n        const { payload } = await jwtVerify(input, key, {\r\n            algorithms: ['HS256'],\r\n        })\r\n        return payload\r\n    } catch (error) {\r\n        return null\r\n    }\r\n}\r\n\r\nexport async function getStudentSession() {\r\n    const cookieStore = await cookies()\r\n    const token = cookieStore.get('clubfit-student-token')?.value\r\n    if (!token) return null\r\n    return await decryptStudentSession(token)\r\n}\r\n\r\nexport async function createStudentSession(studentId: string, academyId: string) {\r\n    const expires = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 dias\r\n    const session = await encryptStudentSession({ studentId, academyId, expires })\r\n\r\n    const cookieStore = await cookies()\r\n    cookieStore.set('clubfit-student-token', session, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === 'production',\r\n        expires,\r\n        sameSite: 'lax',\r\n        path: '/',\r\n    })\r\n}\r\n\r\nexport async function deleteStudentSession() {\r\n    const cookieStore = await cookies()\r\n    cookieStore.delete('clubfit-student-token')\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AACtD,MAAM,MAAM,IAAI,cAAc,MAAM,CAAC;AAE9B,eAAe,sBAAsB,OAAY;IACpD,OAAO,MAAM,IAAI,gMAAO,CAAC,SACpB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,OAAO,gCAAgC;KACzD,IAAI,CAAC;AACd;AAEO,eAAe,sBAAsB,KAAa;IACrD,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oMAAS,EAAC,OAAO,KAAK;YAC5C,YAAY;gBAAC;aAAQ;QACzB;QACA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,0BAA0B;IACxD,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,MAAM,sBAAsB;AACvC;AAEO,eAAe,qBAAqB,SAAiB,EAAE,SAAiB;IAC3E,MAAM,UAAU,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,UAAU;;IAC1E,MAAM,UAAU,MAAM,sBAAsB;QAAE;QAAW;QAAW;IAAQ;IAE5E,MAAM,cAAc,MAAM,IAAA,0KAAO;IACjC,YAAY,GAAG,CAAC,yBAAyB,SAAS;QAC9C,UAAU;QACV,QAAQ,oDAAyB;QACjC;QACA,UAAU;QACV,MAAM;IACV;AACJ;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0KAAO;IACjC,YAAY,MAAM,CAAC;AACvB"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/app/student/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createAdminClient } from '@/utils/supabase/admin'\r\nimport { createStudentSession } from '@/utils/auth-student'\r\nimport { redirect } from 'next/navigation'\r\n\r\nexport async function studentLogin(formData: FormData) {\r\n    const rawCpf = formData.get('cpf') as string\r\n    if (!rawCpf) return { error: 'CPF é obrigatório.' }\r\n\r\n    // Clean CPF\r\n    const cpf = rawCpf.replace(/\\D/g, '')\r\n\r\n    if (cpf.length !== 11) return { error: 'CPF inválido.' }\r\n\r\n    const supabaseAdmin = createAdminClient()\r\n\r\n    // 1. Buscar Aluno (Admin Client para bypass RLS)\r\n    // Precisamos encontrar se esse CPF existe e está ativo.\r\n    const { data: student, error } = await supabaseAdmin\r\n        .from('students')\r\n        .select('id, academy_id, full_name, status')\r\n        .eq('cpf', cpf)\r\n        .single()\r\n\r\n    if (error || !student) {\r\n        return { error: 'CPF não encontrado. Verifique se digitou corretamente.' }\r\n    }\r\n\r\n    if (student.status !== 'ACTIVE') {\r\n        return { error: 'Seu cadastro está inativo. Procure a recepção da academia.' }\r\n    }\r\n\r\n    // 2. Criar Sessão\r\n    await createStudentSession(student.id, student.academy_id)\r\n\r\n    // 3. Redirecionar\r\n    redirect('/student/dashboard')\r\n}\r\n\r\nexport async function studentLogout() {\r\n    const { deleteStudentSession } = await import('@/utils/auth-student')\r\n    await deleteStudentSession()\r\n    redirect('/student/login')\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AAAA;;;;;;AAEO,eAAe,aAAa,QAAkB;IACjD,MAAM,SAAS,SAAS,GAAG,CAAC;IAC5B,IAAI,CAAC,QAAQ,OAAO;QAAE,OAAO;IAAqB;IAElD,YAAY;IACZ,MAAM,MAAM,OAAO,OAAO,CAAC,OAAO;IAElC,IAAI,IAAI,MAAM,KAAK,IAAI,OAAO;QAAE,OAAO;IAAgB;IAEvD,MAAM,gBAAgB,IAAA,+KAAiB;IAEvC,iDAAiD;IACjD,wDAAwD;IACxD,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,cAClC,IAAI,CAAC,YACL,MAAM,CAAC,qCACP,EAAE,CAAC,OAAO,KACV,MAAM;IAEX,IAAI,SAAS,CAAC,SAAS;QACnB,OAAO;YAAE,OAAO;QAAyD;IAC7E;IAEA,IAAI,QAAQ,MAAM,KAAK,UAAU;QAC7B,OAAO;YAAE,OAAO;QAA6D;IACjF;IAEA,kBAAkB;IAClB,MAAM,IAAA,gLAAoB,EAAC,QAAQ,EAAE,EAAE,QAAQ,UAAU;IAEzD,kBAAkB;IAClB,IAAA,iOAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,EAAE,oBAAoB,EAAE,GAAG;IACjC,MAAM;IACN,IAAA,iOAAQ,EAAC;AACb;;;IAtCsB;IAkCA;;AAlCA,+QAAA;AAkCA,+QAAA"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/.next-internal/server/app/student/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {studentLogin as '40448c53ce001ac14e0381464897f62f18f222d153'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}