{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/app/admin/students/actions.ts"],"sourcesContent":["\n'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { redirect } from 'next/navigation'\nimport { revalidatePath } from 'next/cache'\nimport { cleanCPF } from '@/utils/formatters'\n\nimport { cookies } from 'next/headers'\n\nexport async function createStudent(prevState: any, formData: FormData) {\n  const supabase = await createClient()\n\n  // 1. Verificar Autenticação e Permissão\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) return { error: 'Não autenticado.' }\n\n  const { data: profile } = await supabase\n    .from('users')\n    .select('role, academy_id')\n    .eq('id', user.id)\n    .single()\n\n  if (!profile || !['ACADEMY_ADMIN', 'SUPER_ADMIN'].includes(profile.role)) {\n    return { error: 'Permissão negada. Apenas administradores podem cadastrar alunos.' }\n  }\n\n  // 1.5. Determinar Academia Alvo (Context Aware)\n  let targetAcademyId = profile.academy_id\n\n  if (profile.role === 'SUPER_ADMIN') {\n    const cookieStore = await cookies()\n    targetAcademyId = cookieStore.get('admin-context-academy-id')?.value\n\n    if (!targetAcademyId) {\n      return { error: 'Modo Super Admin: Selecione uma academia no menu de contexto (topo da tela) para realizar esta ação.' }\n    }\n  }\n\n  // 2. Coletar e Limpar Dados\n  const fullName = formData.get('full_name') as string\n  const rawCpf = formData.get('cpf') as string\n  const email = formData.get('email') as string\n  const phone = formData.get('phone') as string\n\n  if (!fullName || !rawCpf) {\n    return { error: 'Nome e CPF são obrigatórios.' }\n  }\n\n  const cpf = cleanCPF(rawCpf)\n\n  // Validação simples de tamanho (MVP)\n  if (cpf.length !== 11) {\n    return { error: 'O CPF deve conter exatamente 11 dígitos.' }\n  }\n\n  // 3. Inserir no Banco\n  const { error: insertError } = await supabase\n    .from('students')\n    .insert({\n      academy_id: targetAcademyId,\n      full_name: fullName,\n      cpf: cpf,\n      email: email || null,\n      phone: phone || null,\n      status: 'ACTIVE'\n    })\n\n  if (insertError) {\n    // Tratamento de Erro Específico: CPF Duplicado (constraint unique_cpf)\n    if (insertError.code === '23505') {\n      return { error: 'Este CPF já está cadastrado no sistema ClubFit.' }\n    }\n    console.error('Erro Student:', insertError)\n    return { error: 'Erro ao cadastrar aluno.' }\n  }\n\n  revalidatePath('/admin/students')\n  redirect('/admin/students')\n}\n"],"names":[],"mappings":";;;;;;;IAUsB,gBAAA,WAAA,GAAA,IAAA,kRAAA,EAAA,8CAAA,uQAAA,EAAA,KAAA,GAAA,6QAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/components/ui/form-input.tsx"],"sourcesContent":["import React, { forwardRef } from 'react'\n\ninterface FormInputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string\n  name: string\n  error?: string\n}\n\nexport const FormInput = forwardRef<HTMLInputElement, FormInputProps>(\n  ({ label, name, error, className = '', ...props }, ref) => {\n    return (\n      <div className=\"w-full\">\n        <label htmlFor={name} className=\"block text-sm font-medium text-slate-700 mb-1\">\n          {label}\n        </label>\n        <input\n          id={name}\n          name={name}\n          ref={ref}\n          className={`\n            block w-full rounded-md border-slate-300 shadow-sm \n            focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\n            border p-2\n            ${error ? 'border-red-500 focus:border-red-500 focus:ring-red-500' : ''}\n            ${className}\n          `}\n          {...props}\n        />\n        {error && <p className=\"mt-1 text-sm text-red-600\">{error}</p>}\n      </div>\n    )\n  }\n)\n\nFormInput.displayName = 'FormInput'"],"names":[],"mappings":";;;;;AAAA;;;AAQO,MAAM,0BAAY,IAAA,2MAAU,OACjC,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,YAAY,EAAE,EAAE,GAAG,OAAO,EAAE;IACjD,qBACE,6NAAC;QAAI,WAAU;;0BACb,6NAAC;gBAAM,SAAS;gBAAM,WAAU;0BAC7B;;;;;;0BAEH,6NAAC;gBACC,IAAI;gBACJ,MAAM;gBACN,KAAK;gBACL,WAAW,CAAC;;;;YAIV,EAAE,QAAQ,2DAA2D,GAAG;YACxE,EAAE,UAAU;UACd,CAAC;gBACA,GAAG,KAAK;;;;;;YAEV,uBAAS,6NAAC;gBAAE,WAAU;0BAA6B;;;;;;;;;;;;AAG1D;;AAGF,UAAU,WAAW,GAAG"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/carolina/Desktop/00%20-%20Clubfit/app/admin/students/new/page.tsx"],"sourcesContent":["\n'use client'\n\nimport { createStudent } from '../actions'\nimport { FormInput } from '@/components/ui/form-input'\nimport Link from 'next/link'\nimport { useState } from 'react'\n\nexport default function NewStudentPage() {\n  const [error, setError] = useState<string | null>(null)\n\n  async function handleSubmit(formData: FormData) {\n    setError(null)\n    const result = await createStudent(null, formData)\n    if (result?.error) {\n      setError(result.error)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 flex flex-col\">\n       <nav className=\"bg-white border-b border-slate-200 px-8 py-4\">\n        <div className=\"max-w-3xl mx-auto flex items-center gap-4\">\n            <Link href=\"/admin/students\" className=\"text-sm text-slate-500 hover:text-slate-900\">\n                ← Voltar\n            </Link>\n            <h1 className=\"font-bold text-xl text-slate-900\">Novo Aluno</h1>\n        </div>\n      </nav>\n\n      <main className=\"flex-1 p-8\">\n        <div className=\"max-w-3xl mx-auto\">\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-8\">\n                <form action={handleSubmit} className=\"space-y-6\">\n                    \n                    <FormInput \n                        label=\"Nome Completo\" \n                        name=\"full_name\" \n                        placeholder=\"Ex: Ana Souza\" \n                        required \n                    />\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                         <FormInput \n                            label=\"CPF (Apenas números ou com pontos)\" \n                            name=\"cpf\" \n                            placeholder=\"000.000.000-00\" \n                            required \n                            maxLength={14}\n                        />\n                        <FormInput \n                            label=\"Telefone (WhatsApp)\" \n                            name=\"phone\" \n                            placeholder=\"(11) 99999-9999\" \n                        />\n                    </div>\n\n                    <FormInput \n                        label=\"E-mail (Opcional)\" \n                        name=\"email\" \n                        type=\"email\"\n                        placeholder=\"ana.souza@email.com\" \n                    />\n\n                    {error && (\n                        <div className=\"bg-red-50 text-red-600 p-4 rounded-md text-sm border border-red-100\">\n                            {error}\n                        </div>\n                    )}\n\n                    <div className=\"pt-4 flex justify-end gap-3\">\n                        <Link \n                            href=\"/admin/students\"\n                            className=\"px-4 py-2 border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50 text-sm font-medium\"\n                        >\n                            Cancelar\n                        </Link>\n                        <button\n                            type=\"submit\"\n                            className=\"px-4 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 text-sm font-medium\"\n                        >\n                            Cadastrar Aluno\n                        </button>\n                    </div>\n\n                </form>\n            </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;;;AALA;;;;;AAOe,SAAS;;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yMAAQ,EAAgB;IAElD,eAAe,aAAa,QAAkB;QAC5C,SAAS;QACT,MAAM,SAAS,MAAM,IAAA,oNAAa,EAAC,MAAM;QACzC,IAAI,QAAQ,OAAO;YACjB,SAAS,OAAO,KAAK;QACvB;IACF;IAEA,qBACE,6NAAC;QAAI,WAAU;;0BACZ,6NAAC;gBAAI,WAAU;0BACd,cAAA,6NAAC;oBAAI,WAAU;;sCACX,6NAAC,0MAAI;4BAAC,MAAK;4BAAkB,WAAU;sCAA8C;;;;;;sCAGrF,6NAAC;4BAAG,WAAU;sCAAmC;;;;;;;;;;;;;;;;;0BAIvD,6NAAC;gBAAK,WAAU;0BACd,cAAA,6NAAC;oBAAI,WAAU;8BACX,cAAA,6NAAC;wBAAI,WAAU;kCACX,cAAA,6NAAC;4BAAK,QAAQ;4BAAc,WAAU;;8CAElC,6NAAC,kLAAS;oCACN,OAAM;oCACN,MAAK;oCACL,aAAY;oCACZ,QAAQ;;;;;;8CAGZ,6NAAC;oCAAI,WAAU;;sDACV,6NAAC,kLAAS;4CACP,OAAM;4CACN,MAAK;4CACL,aAAY;4CACZ,QAAQ;4CACR,WAAW;;;;;;sDAEf,6NAAC,kLAAS;4CACN,OAAM;4CACN,MAAK;4CACL,aAAY;;;;;;;;;;;;8CAIpB,6NAAC,kLAAS;oCACN,OAAM;oCACN,MAAK;oCACL,MAAK;oCACL,aAAY;;;;;;gCAGf,uBACG,6NAAC;oCAAI,WAAU;8CACV;;;;;;8CAIT,6NAAC;oCAAI,WAAU;;sDACX,6NAAC,0MAAI;4CACD,MAAK;4CACL,WAAU;sDACb;;;;;;sDAGD,6NAAC;4CACG,MAAK;4CACL,WAAU;sDACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWzB;GAnFwB;KAAA"}}]
}